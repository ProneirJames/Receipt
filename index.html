<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Page title</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <style>
        :root{
            --themeColor: "red";
        }
        *{
            margin: 0;
            padding:0;
        }
        .flex{
            display: flex;
        }
        .nowrap{
            flex-wrap: nowrap;
        }
        .flex-col{
            flex-direction: column;
        }
        .justify-around{
            justify-content: space-around;
        }
        .justify-between {
            justify-content: space-between;
        }
        .justify-center {
            justify-content: center;
        }
        .grow{
            flex-grow: 1;
        }
        .border-bottom-dotted{
            border-bottom: dotted 1px #ff5e00d5;
            margin: 0 3px;
            font-size: 9px;
            color: #080d5b;
        }
        .text-center{
            text-align: center;
        }
        .text-left{
            text-align: left;
        }
        .text-right{
            text-align: right;
        }
        #receipt{
            color: #ff5e00d5;
        }
        .details{
            height: 20px;
            align-items: center;
        }
        .hidden-input{
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 97%;
            height: 85%;
        }
        .hidden-input:focus{
            opacity: 1;
        }
        input{
            outline: none;
        }
        .exportButton{
            position: relative;
            z-index: 1;
        }
        .exportButton:hover .selectMenu{
            display: block;
        }
        .selectMenu{
            border-radius: 5px;
            box-shadow: 0 0 10px #1f1f1f89;
            font-family: Inter;
            font-size: 8px;
            background: white;
            position: absolute;
            min-width: 100px;
            display: none;
            z-index: 2;
        }
        .selectMenu div{
            padding: 8px;
            color: black;
        }
        .selectMenu div:hover{
            background: #d1d1d1;
        }
    </style>
</head>
<body>
    <div style="width:300px;height:424px;padding:10px; font-family: Inter; position: relative;margin:30px auto; background: #fff4aaa7; box-shadow: 0 5px 10px #18181831;" id="receipt">
        <div style="display:flex; justify-content:space-between;font-size:7px;">
            <div>UDISE Code : 10230906610</div>
            <div>Established : 26th January, 1996</div>
        </div>
        <div style="display:flex; justify-content: space-between;">
            <img src="./jpps_logo.svg" style="width:45px;margin: -1px -4px -10px 0;">
            <div class="grow flex flex-col justify-center" style="">
                <div style="font-size: 15.5px; font-weight: 900;" class="text-right">J.P-P.S TEACHING CURRICULUM</div>
                <div style="display:flex;flex-flow:row nowrap;font-size: 10px;"><span style="flex-grow:1;border-bottom:solid 1px #ff5e00d5;"></span><span style="font-style:italic;">Reflect Your Success</span></div>
            </div>
        </div>
        <div style="background: #ff5e00d5;font-size: 10px; font-weight: 700; margin-top:6px; text-align :center; padding:3px;color:white; border-radius: 2px;">AN ENGLISH MEDIUM RESIDENTIAL SCHOOL</div>
        <div style="font-size: 8px; font-weight: 500; text-align: center; line-height: 1.5; margin-top: 3px;">
            <div>Hussain Nagar Kurma near Highway SH-84, Dhoraiya, Banka, Bihar - 813224</div>
            <div>Call : +91 9661716014, +91 6205965449</div>
        </div>
        <div style="font-size:9px; line-height: 1;margin: 5px 0 10px 0;">
            <div class="flex nowrap justify-between details">
                <div style="font-weight: bold;">Name - </div>
                <div class="border-bottom-dotted grow" contentEditable="true"></div>
            </div>
            <div class="flex nowrap justify-between details">
                <div style="font-weight: bold;">Father's Name - </div>
                <div class="border-bottom-dotted grow" contentEditable="true"></div>
            </div>
            <div class="flex nowrap details">
                <div style="font-weight: bold;">Class - </div>
                <div class="border-bottom-dotted grow" contentEditable="true"></div>
                <div style="font-weight: bold;">Roll no. - </div>
                <div class="border-bottom-dotted grow" contentEditable="true"></div>
                <div style="font-weight: bold;">Date - </div>
                <div class="border-bottom-dotted grow" contentEditable="true"></div>
            </div>
        </div>
        <table style="border-collapse:collapse;width:100%;height: 52%;">
            <thead style="font-size:9px;">
                <tr style="background:#ff5e00d5;border-color: black;">
                    <th class="text-center" style="border:solid 1px #ff5e00d5;padding: 2px;color: white;">PARTICULAR</th>
                    <th class="text-center" style="border:solid 1px #ff5e00d5;padding: 2px;color: white;">COLUMN</th>
                </tr>
            </thead>
            <tbody style="font-size:9px;">
                <tr>
                    
                </tr>
            </tbody>
        </table>
        <div class="text-right flex flex-col nowrap" style="position: absolute; bottom: 10px; right: 10px;font-size: 9px;">
            <img src="./sign.png" style="width:60px;" />
            <span style="transform: skew(-15deg); display: inline-block;margin-top:-3px;">Principal</span>
        </div>
    </div>
    
    <div style="display:flex;flex-flow: row wrap; justify-content: center;gap: 20px;margin: 0 20px; font-family: Inter;font-size: 12px;">
        <div style="width:100%;max-width: 300px; padding: 15px; text-align : center;border-radius:5px; background: #4be24e;color:white;z-index: 2" class="exportButton">Download
           <div class="selectMenu">
               <div onClick="exportReceipt('image','download')">Image</div>
               <div onClick="exportReceipt('pdf','download')" >PDF</div>
           </div>
        </div>
        <div style="width:100%;padding: 15px; text-align : center;border-radius:5px; background: #298ff3;color:white;z-index:1;" class="exportButton">Share
            <div class="selectMenu">
               <div onClick="exportReceipt('image','share')">Image</div>
               <div onClick="exportReceipt('pdf','share')">PDF</div>
           </div>
        </div>
    </div>
<script>
    
let feeBox = document.querySelector("tbody");
let total = [];
const { jsPDF } = window.jspdf;

let fees = [
    {
        name: "Tution Fee",
        type: "date"
    },
    {
        name: "Hostle Fee",
        type: "date"
    },
    {
        name: "Maktab Fee",
        type: "date"
    },
    {
        name: "Tie + Belt + Batch",
        type: ""
    },
    {
        name: "Id Card",
        type: ""
    },
    {
        name: "Books",
        type: ""
    },
    {
        name: "Copy",
        type: ""
    },
    {
        name: "Bag",
        type: ""
    },
    {
        name: "Exam Fee/Other fee",
        type: "text"
    },
    {
        name: "Medical Fee",
        type: ""
    },
    {
        name: "Canteen",
        type: ""
    },
    {
        name: "Advance",
        type: ""
    },
    {
        name: "Sub Total",
        type: "total"
    }
]
fees = fees.map((fee,i)=>{
    return (`
        <tr>
            <td class=${fee.type==="total" ? "text-center" : "text-left"} style="position: relative;width:60%;border-style:solid;padding: ${fee.type === 'total' ? '2px' : '1px'} 6px;font-weight:${fee.type === 'total' ? 'bold' : 'normal'}" ${fee.type === 'text' ? 'contentEditable="true"' : ""}>
                ${fee.name}
                ${(fee.type === "date") ? `<span class="month" style="font-weight:bold;"></span><select type="date"  style="position: absolute;top:0;left:0;width:100%;height:100%;opacity:0;" onchange="handleMonth(this)" >
                    <option disabled checked>Choose month</option>
                    <option>January</option>
                    <option>February</option>
                    <option>March</option>
                    <option>April</option>
                    <option>May</option>
                    <option>June</option>
                    <option>July</option>
                    <option>August</option>
                    <option>September</option>
                    <option>Octuber</option>
                    <option>November</option>
                    <option>December</option>
                </select>` : ""}
            </td>
            <td contentEditable="true" class="text-center ${fee.type === 'total' ? 'totalBox' : ''}" style="border:solid 1px #ff5e00d5; position: relative;color:#080d5b">
                <span>-</span>
                <input type="number" class="hidden-input" style="text-align:center;" oninput="handleAmount(this,${i})"  />
            </td>
        </tr>
    `)
}).join("");
feeBox.innerHTML = fees;

function handleMonth(el){
    [...document.querySelectorAll(".month")].forEach(item=>{
        item.textContent = `(${el.value})`;
    })
}

function handleAmount(el,i){
    el.previousElementSibling.textContent = el.value ? `₹${Math.floor(el.value).toFixed(2)}` : "-";
    total[i] = el.value;
    let amount = total.reduce((acc,val)=>{
        return acc + Number(val || 0);
    },0);
    document.querySelector(".totalBox").textContent = `₹${Math.floor(amount).toFixed(2)}`;
}





async function exportReceipt(format = "pdf", action = "download") {
 
  const el = document.getElementById("receipt");
  const filename = `${Date.now()}`

  // Optimized html2canvas
  const canvas = await html2canvas(el, {
    scale: 14,
    useCORS: true,
    allowTaint: false,
    backgroundColor: "#ffffff",
    logging: false,
    imageTimeout: 0
  });

  const imgData = canvas.toDataURL("image/jpeg", 0.82);

  // ----------- CASE: JPG IMAGE -----------
  if (format === "jpg" || format === "jpeg") {
    if (action === "download") {
      const a = document.createElement("a");
      a.href = imgData;
      a.download = `${filaname}.jpg`;
      a.click();
      return;
    }

    if (action === "share") {
      const blob = await (await fetch(imgData)).blob();
      const file = new File([blob], `${filename}.jpg`, { type: "image/jpeg" });

      if (navigator.share) {
        await navigator.share({
          title: "Shared Image",
          files: [file]
        });
      } else {
        alert("Sharing is not supported on this device.");
      }
      return;
    }
  }

  // ----------- CASE: PDF -----------
  if (format === "pdf") {
    const pdf = new jsPDF("p", "px", [300,417]);
    const pageWidth = pdf.internal.pageSize.getWidth();

    const ratio = canvas.width / canvas.height;
    const imgWidth = pageWidth;
    const imgHeight = pageWidth / ratio;

    pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);

    if (action === "download") {
      pdf.save(`${filename}.pdf`);
      return;
    }

    if (action === "share") {
      const pdfBlob = pdf.output("blob");
      const pdfFile = new File([pdfBlob], `${filename}.pdf`, { type: "application/pdf" });

      if (navigator.share) {
        await navigator.share({
          title: "Shared PDF",
          files: [pdfFile]
        });
      } else {
        alert("Sharing is not supported on this device.");
      }
    }
  }
}





</script>
</body>
</html>
